<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #06b6d4;
        }
        .bg-primary { background-color: var(--primary); }
        .bg-secondary { background-color: var(--secondary); }
        .text-accent { color: var(--accent); }
        .bg-accent { background-color: var(--accent); }
    </style>
</head>
<body class="bg-primary text-white">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-6">Homepage Content Test</h1>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Popular Movies</h2>
            <div id="popularMoviesContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <p>Loading...</p>
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Popular TV Shows</h2>
            <div id="popularTVShowsContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <p>Loading...</p>
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Trending Movies</h2>
            <div id="latestMoviesContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <p>Loading...</p>
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Trending TV Shows</h2>
            <div id="latestTVShowsContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const SCRAPER_API_BASE = 'https://web-1-production.up.railway.app';
        
        // Scrape popular movies
        async function scrapePopularMovies() {
            try {
                const response = await fetch(`${SCRAPER_API_BASE}/top`);
                const data = await response.json();
                
                if (data.items) {
                    return data.items.map(item => ({
                        id: item.imdb_id,
                        title: item.title,
                        year: item.year || 'N/A',
                        image: item.image || '',
                        type: 'movie',
                        actors: item.cast || [],
                        rating: item.rating || ''
                    }));
                }
                return [];
            } catch (error) {
                console.error('Error fetching popular movies:', error);
                return [];
            }
        }
        
        // Scrape popular TV shows
        async function scrapePopularTVShows() {
            try {
                const response = await fetch(`${SCRAPER_API_BASE}/popular`);
                const data = await response.json();
                
                if (data.items) {
                    return data.items.map(item => ({
                        id: item.imdb_id,
                        title: item.title,
                        year: item.year || 'N/A',
                        image: item.image || '',
                        type: 'tv',
                        actors: item.cast || [],
                        rating: item.rating || ''
                    }));
                }
                return [];
            } catch (error) {
                console.error('Error fetching popular TV shows:', error);
                return [];
            }
        }
        
        // Scrape latest movies
        async function scrapeLatestMovies() {
            try {
                const response = await fetch(`${SCRAPER_API_BASE}/popular`);
                const data = await response.json();
                
                if (data.items) {
                    return data.items.map(item => ({
                        id: item.imdb_id,
                        title: item.title,
                        year: item.year || 'N/A',
                        image: item.image || '',
                        type: 'movie',
                        actors: item.cast || [],
                        rating: item.rating || ''
                    }));
                }
                return [];
            } catch (error) {
                console.error('Error fetching latest movies:', error);
                return [];
            }
        }
        
        // Scrape latest TV shows
        async function scrapeLatestTVShows() {
            try {
                const response = await fetch(`${SCRAPER_API_BASE}/popular`);
                const data = await response.json();
                
                if (data.items) {
                    return data.items.map(item => ({
                        id: item.imdb_id,
                        title: item.title,
                        year: item.year || 'N/A',
                        image: item.image || '',
                        type: 'tv',
                        actors: item.cast || [],
                        rating: item.rating || ''
                    }));
                }
                return [];
            } catch (error) {
                console.error('Error fetching latest TV shows:', error);
                return [];
            }
        }
        
        // Display popular content
        function displayPopularContent(contentList, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            contentList.forEach(item => {
                const contentCard = document.createElement('div');
                contentCard.className = 'bg-secondary rounded-lg overflow-hidden hover:shadow-xl transition duration-300 cursor-pointer transform hover:-translate-y-1';
                
                // Build the HTML with additional information
                let additionalInfo = '';
                if (item.type) {
                    additionalInfo += `<span class="inline-block bg-accent text-primary text-xs px-1 py-0.5 rounded mr-1 mt-1">${item.type}</span>`;
                }
                if (item.rating) {
                    additionalInfo += `<span class="inline-block bg-gray-700 text-white text-xs px-1 py-0.5 rounded mr-1 mt-1">${item.rating}</span>`;
                }
                
                contentCard.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="w-full h-48 object-cover">
                    <div class="p-3">
                        <h4 class="font-bold text-sm mb-1 truncate">${item.title}</h4>
                        <p class="text-gray-400 text-xs">${item.year}</p>
                        ${additionalInfo}
                        ${item.actors && item.actors.length > 0 ? `<p class="text-gray-300 text-xs mt-1 truncate">${item.actors.slice(0, 3).join(', ')}</p>` : ''}
                    </div>
                `;
                
                contentCard.addEventListener('click', () => {
                    alert(`Clicked on ${item.title}`);
                });
                
                container.appendChild(contentCard);
            });
        }
        
        // Load all content
        async function loadAllContent() {
            try {
                // Show loading indicators
                const containers = [
                    'popularMoviesContainer', 
                    'popularTVShowsContainer',
                    'latestMoviesContainer',
                    'latestTVShowsContainer'
                ];
                
                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = '<p class="text-center col-span-full">Loading data...</p>';
                    }
                });
                
                // Fetch popular movies
                const popularMovies = await scrapePopularMovies();
                displayPopularContent(popularMovies, 'popularMoviesContainer');
                
                // Fetch popular TV shows
                const popularTVShows = await scrapePopularTVShows();
                displayPopularContent(popularTVShows, 'popularTVShowsContainer');
                
                // Fetch latest movies
                const latestMovies = await scrapeLatestMovies();
                displayPopularContent(latestMovies, 'latestMoviesContainer');
                
                // Fetch latest TV shows
                const latestTVShows = await scrapeLatestTVShows();
                displayPopularContent(latestTVShows, 'latestTVShowsContainer');
            } catch (error) {
                console.error('Error loading content:', error);
            }
        }
        
        // Load content when page is ready
        document.addEventListener('DOMContentLoaded', loadAllContent);
    </script>
</body>
</html>