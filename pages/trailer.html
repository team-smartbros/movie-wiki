<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Trailer - Movie Wiki</title>
    <link rel="icon" href="../assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #22d3ee;
        }
        
        body {
            background-color: var(--primary);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .trailer-video {
            width: 100%;
            max-width: 1200px;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        .back-button {
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            transform: translateX(-5px);
            color: var(--accent);
        }
        
        /* Video player styles */
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #000;
        }
        
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--accent);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error message styling */
        .error-container {
            max-width: 600px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 12px;
            padding: 2rem;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .trailer-video {
                border-radius: 8px;
            }
            
            .error-container {
                padding: 1.5rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Header -->
    <header class="glass-card border-b border-gray-700 py-4">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-2 back-button">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Home</span>
                </a>
                <div class="flex items-center gap-2">
                    <i class="fas fa-film text-accent"></i>
                    <span class="font-bold text-accent">Movie Wiki</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col items-center">
            <!-- Trailer Title -->
            <h1 id="trailerTitle" class="text-2xl md:text-3xl font-bold mb-6 text-center">Loading Trailer...</h1>
            
            <!-- Trailer Video Container -->
            <div class="trailer-video glass-card mb-6">
                <div id="videoContainer" class="w-full h-full flex items-center justify-center">
                    <div class="flex flex-col items-center">
                        <div class="spinner mb-4"></div>
                        <p>Loading trailer...</p>
                    </div>
                </div>
            </div>
            
            <!-- Buttons Container -->
            <div class="flex flex-col sm:flex-row gap-4 w-full max-w-md mb-6">
                <a id="detailsButton" href="#" class="flex-1 bg-accent hover:bg-cyan-400 text-primary font-bold py-3 px-4 rounded-lg transition duration-300 text-center">
                    <i class="fas fa-info-circle mr-2"></i>Go to Details
                </a>
                <a id="streamButton" href="#" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-center">
                    <i class="fas fa-play mr-2"></i>Watch Now
                </a>
            </div>
            
            <!-- Error Message Container -->
            <div id="errorContainer" class="error-container hidden">
                <h2 class="text-xl font-bold mb-4 text-center text-red-400">⚠️ Trailer Playback Error</h2>
                <p id="errorMessage" class="text-gray-300 mb-6 text-center">Unable to load trailer.</p>
                <div class="flex flex-col gap-3">
                    <button id="retryButton" class="bg-accent hover:bg-cyan-400 text-primary font-bold py-2 px-4 rounded-lg transition duration-300">
                        Retry Playback
                    </button>
                    <button id="searchButton" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Search on YouTube
                    </button>
                    <a href="index.html" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-center">
                        Back to Home
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass-card border-t border-gray-700 py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-film text-accent"></i>
                        <span class="font-bold text-accent">Movie Wiki</span>
                    </div>
                    <p class="text-gray-400 text-sm mt-2">&copy; 2025 Movie Wiki. All rights reserved.</p>
                </div>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="privacy-policy.html" class="text-gray-400 hover:text-accent transition-colors text-sm">Privacy Policy</a>
                    <a href="terms-of-service.html" class="text-gray-400 hover:text-accent transition-colors text-sm">Terms of Service</a>
                    <a href="disclaimer.html" class="text-gray-400 hover:text-accent transition-colors text-sm">Disclaimer</a>
                    <a href="cookie-policy.html" class="text-gray-400 hover:text-accent transition-colors text-sm">Cookie Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                url: params.get('url'),
                title: params.get('title'),
                movieId: params.get('movieId'),
                poster: params.get('poster'),
                year: params.get('year'),
                plot: params.get('plot'),
                rating: params.get('rating')
            };
        }
        
        // Initialize trailer page
        document.addEventListener('DOMContentLoaded', function() {
            const params = getUrlParams();
            console.log('Trailer page loaded with params:', params);
            
            // Set page title
            if (params.title) {
                document.title = `Watch ${params.title} Trailer - Movie Wiki`;
                document.getElementById('trailerTitle').textContent = `${params.title} Trailer`;
            }
            
            // Set up details button
            if (params.movieId) {
                document.getElementById('detailsButton').href = `details.html?id=${params.movieId}&title=${encodeURIComponent(params.title || '')}`;
            } else {
                document.getElementById('detailsButton').href = 'index.html';
            }
            
            // Set up stream button
            if (params.movieId) {
                document.getElementById('streamButton').href = `stream.html?id=${params.movieId}&title=${encodeURIComponent(params.title || '')}`;
            } else {
                document.getElementById('streamButton').href = 'stream.html';
            }
            
            // Load trailer if URL is provided
            if (params.url) {
                loadTrailer(params.url);
            } else {
                showError('No trailer URL provided.', params.title);
            }
            
            // Set up event listeners
            document.getElementById('retryButton').addEventListener('click', function() {
                if (params.url) {
                    loadTrailer(params.url);
                }
            });
            
            document.getElementById('searchButton').addEventListener('click', function() {
                const searchQuery = params.title ? `${params.title} trailer` : 'movie trailer';
                window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`, '_blank');
            });
        });
        
        // Load trailer video
        function loadTrailer(videoUrl) {
            console.log('Loading trailer:', videoUrl);
            
            // Hide error container and show video container
            document.getElementById('errorContainer').classList.add('hidden');
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = `
                <div class="flex flex-col items-center">
                    <div class="spinner mb-4"></div>
                    <p>Loading trailer...</p>
                </div>
            `;
            
            // Create video element
            const video = document.createElement('video');
            video.controls = true;
            video.autoplay = true;
            video.playsInline = true;
            video.className = 'w-full h-full';
            
            // Add attributes to prevent controls on hover
            video.setAttribute('controlsList', 'nodownload nofullscreen noremoteplayback');
            video.setAttribute('disableRemotePlayback', '');
            
            // Set video source
            video.src = videoUrl;
            
            // Handle video load success
            video.onloadeddata = function() {
                console.log('Trailer loaded successfully');
                videoContainer.innerHTML = '';
                videoContainer.appendChild(video);
            };
            
            // Handle video load error
            video.onerror = function(e) {
                console.error('Trailer load error:', e);
                showError('Failed to load trailer. This may be due to content restrictions from the provider.', 
                         document.getElementById('trailerTitle').textContent.replace(' Trailer', ''));
            };
            
            // Handle video play
            video.onplay = function() {
                console.log('Trailer started playing');
            };
            
            // Handle video pause
            video.onpause = function() {
                console.log('Trailer paused');
            };
        }
        
        // Show error message
        function showError(message, movieTitle) {
            console.log('Showing error:', message);
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorContainer').classList.remove('hidden');
            document.getElementById('videoContainer').innerHTML = `
                <div class="flex items-center justify-center h-full">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-500"></i>
                </div>
            `;
        }
    </script>
</body>
</html>
